<!DOCTYPE html>
<html>
<head>
    <title>Kùzu Webapp</title>
    <script src="https://visjs.github.io/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        #network { width: 100%; height: 400px; border: 1px solid lightgray; margin-top: 20px; }
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        form { margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>Kùzu Graph Database</h1>
    <h2>Add Link</h2>
    <form method="POST" action="/add_link">
        <label for="url">URL:</label>
        <input type="text" id="url" name="url" required>
        <button type="submit">Add Link</button>
    </form>
    <h2>Links</h2>
    <table>
        <tr><th>URL</th><th>Title</th><th>Category</th><th>Raw Category</th><th>Extracted Keywords</th><th>Raw Content</th></tr>
        {% for link in links %}
        <tr>
            <td>{{ link.url }}</td>
            <td>{{ link.title }}</td>
            <td>{{ link.category }}</td>
            <td>{{ link.raw_category }}</td>
            <td>{{ link.keywords }}</td>
            <td>{{ link.raw_content }}</td>
        </tr>
        {% endfor %}
    </table>
    <h2>Graph Visualization</h2>
    <div id="network"></div>
    <h2>Interconnected Links by Shared Keywords</h2>
    <table>
        <tr><th>Link 1</th><th>Link 2</th><th>Shared Keyword</th><th>Category 1</th><th>Category 2</th></tr>
        {% for conn in interconnections %}
        <tr>
            <td>{{ conn.link1 }}</td>
            <td>{{ conn.link2 }}</td>
            <td>{{ conn.keyword }}</td>
            <td>{{ conn.category1 }}</td>
            <td>{{ conn.category2 }}</td>
        </tr>
        {% endfor %}
    </table>
    <script>
        fetch('/graph_data')
            .then(response => response.json())
            .catch(error => console.error('Error fetching graph data:', error))
            .then(data => {
                if (data.error) {
                    console.error('Graph data error:', data.error);
                    document.getElementById('network').innerHTML = 'Graph failed to load: ' + data.error;
                    return;
                }
                const nodes = new vis.DataSet(data.nodes);
                const edges = new vis.DataSet(data.edges);
                const container = document.getElementById('network');
                const graphData = { nodes: nodes, edges: edges };
                const options = {
                    nodes: {
                        shape: 'dot',
                        size: 20,
                        font: { size: 14 },
                        color: { background: { Link: '#97C2FC', Category: '#FF7F7F', Keyword: '#7FFF7F' } }
                    },
                    edges: { arrows: 'to', color: '#000000' }
                };
                new vis.Network(container, graphData, options);
            });
    </script>
</body>
</html>